<!-- part HTML_SETTINGS_HEADER -->
<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESP XXXX WiFi Manager</title>
    <style type="text/css">
    html,input,p {
    text-align: justify;
    font-size: 17px;
    line-height: 1.47059;
    letter-spacing: .008em;
    color: #f2f2f7
}
html,input {
    font-family: "SF Pro Display","Helvetica Neue","Helvetica","Arial",sans-serif;
    background-color: #333;
    font-weight: 200
}
#join,#search,input[type=password],input[type=text] {
    letter-spacing: .008em;
    color: #f2f2f7;
    margin: 0
}
h1 {
    padding: 0;
    font-size: 40px;
    text-align: center;
    line-height: 1.05;
    font-weight: 500
}
p {
    font-style: normal;
    font-weight: 400
}
body .container {
    width: 70%;
    margin: 0 auto;
    padding: 1em
}
label {
    display: block
}
input[type=password],input[type=text] {
    height: 3.25rem;
    font-family: inherit;
    font-weight: 300;
    border-radius: 7px;
    border: 1px solid #bbb;
    font-size: 1.375rem;
    padding-left: 10px;
    line-height: 1.5294717647;
    text-align: left;
    width: 100%
}
input[type=submit] {
    width: 100%;
    border: 1px solid #000;
    text-decoration: none;
    background-color: #4caf50;
    cursor: pointer
}
#search,input[type=submit]#join {
    height: 3.25rem;
    font-family: inherit;
    font-weight: 300;
    border-radius: 7px;
    font-size: 1.375rem;
    line-height: 1.5294717647
}
input[type=submit]#search {
    border: 1px solid #555;
    background-color: #444;
    text-align: center
}
input[type=submit]#join {
    border: 1px solid #71d342;
    background-color: #71d342;
    text-align: center
}
input[type=submit][disabled] {
    color: #aaa;
    border: 1px solid #555!important;
    background-color: #444!important
}
.networks {
    list-style: none;
    margin: 1em 0;
    padding: 0
}
.networks,.networks li,.networks li.secure::before {
    font-size: 1.375rem;
    line-height: 1.47059;
    font-weight: 100
}
.networks li {
    cursor: pointer;
    margin-bottom: .25em;
    white-space: nowrap;
    overflow: hidden;
    padding: .25em .25em .25em 1.1em;
    position: relative
}
.networks li.secure::before {
    content: "ðŸ”’";
    position: absolute;
    left: 0
}
.networks li.selected {
    border-radius: 7px;
    font-size: 1.375rem
}
.networks li.selected,.networks li:hover {
    line-height: 1.47059;
    font-weight: 100
}
.networks li.other,.networks li:hover {
    background-color: #444;
    border-radius: 7px;
    font-size: 1.375rem
}
.networks li.other {
    height: 3.25rem;
    font-family: inherit;
    font-weight: 300;
    padding: 8px;
    letter-spacing: .008em;
    color: #f2f2f7;
    border: 1px solid #555;
    line-height: 1.5294717647;
    margin: 0;
    box-sizing: border-box;
    width: 100%;
    text-align: center
}
.nonetworks {
    text-align: center;
    margin: 1em 0
}
.field {
    margin-bottom: .5em
}

.field.required label::before {
    content: "*";
    color: red
}
    </style>
  </head>
  <body>
    <div class="container">
      <!-- part HTML_SETTINGS_CUSTOM_HTML {{ custom_html|safe }} part HTML_SETTINGS_BODY -->
      <h1>WiFi Manager</h1><br>
      <form action="/settings" method="get">
        <input type="submit" id="search" value="&#8981; Search"/>
      </form>
      <form action="/settings" method="post">
        <div class="nonetworks" style="display: none;">
          No networks found
        </div>
        <ul id="networks" class="networks">
          <!-- part HTML_NETWORK_ITEM -->
          {% for network in networks %}
            <li class="{{ network.secure | ternary('secure', 'unsecure') }}">{{ network.ssid }}</li>
          {% endfor %}
          <!-- part HTML_SETTINGS_FOOTER -->
          <br>
          <li class="other">Other</li>
        </ul>
        <div class="field required ssid" style="display: none;">
          <label for="ssid">SSID:</label>
          <input type="text" id="ssid" name="ssid" placeholder=" Type your network name here"/>
        </div>
        <div class="field required password" style="display: none;">
          <label for="password">Password:</label>
          <input type="password" id="password" name="password" placeholder=" &#x25CF;&#x25CF;&#x25CF;&#x25CF;&#x25CF;&#x25CF;&#x25CF;&#x25CF;&#x25CF;"/>
        </div>
        <br>
        <input type="submit" id="join" value="Join" disabled="disabled"/>
      </form>
    </div>
    <script>
      var ssid_field,
        password_block,
        password_field,
        join_button;

      networks_block = document.getElementById('networks');
      ssid_block = document.querySelector('.field.ssid');
      ssid_field = document.getElementById('ssid');
      password_block = document.querySelector('.field.password');
      password_field = document.getElementById('password');
      join_button = document.getElementById('join');
      function enable(e) {
        e.disabled = '';
      }
      function disable(e) {
        e.disabled = 'disabled';
      }
      function show(e) {
        e.style.display = 'block';
      }
      function hide(e) {
        e.style.display = 'none';
      }
      function selectNetwork(e) {
        let nets = document.querySelectorAll('ul.networks li');
        for (var i = 0; i < nets.length; i++) {
          nets[i].classList.remove('selected');
        }
        e.classList.add('selected');
      }
      var nets,
        i;
      nets = document.querySelectorAll('ul.networks li.unsecure');
      for (i = 0; i < nets.length; i++) {
        nets[i].onclick = function (event) {
          event.preventDefault();
          selectNetwork(this);
          ssid_field.value = this.innerText;
          hide(ssid_block);
          hide(password_block);
          disable(password_field);
          password_field.value = '';
          enable(join_button);
        }
      }
      nets = document.querySelectorAll('ul.networks li.secure');
      for (i = 0; i < nets.length; i++) {
        nets[i].onclick = function (event) {
          event.preventDefault();
          selectNetwork(this);
          ssid_field.value = this.innerText;
          hide(ssid_block);
          enable(password_field);
          show(password_block);
          disable(join_button);
          password_block.classList.add('required');
        }
      }
      nets = document.querySelectorAll('ul.networks li.other');
      for (i = 0; i < nets.length; i++) {
        nets[i].onclick = function (event) {
          event.preventDefault();
          if (this.classList.contains('selected'))
            return;
          selectNetwork(this);
          ssid_field.value = "";
          show(ssid_block);
          show(password_block);enable(ssid_field);
          enable(password_field);
          disable(join_button);
          password_block.classList.remove('required');
        }
      }
      if (document.querySelectorAll('ul.networks li').length == 1) {
        show(document.querySelector('.nonetworks'));
        hide(networks_block);
        show(ssid_block);
        show(password_block);
        password_block.classList.remove('required');
      }
      let s = ssid_field;
      let p = password_field;
      s.onchange = s.onkeydown = s.onpaste = s.oninput = p.onchange = p.onkeydown = p.onpaste = p.oninput = function (event) {
        var f = enable;
        if (ssid_block.classList.contains('required') && ssid_field.value == '') {
          f = disable;
        }
        if (password_block.classList.contains('required') && password_field.value == '') {
          f = disable;
        }
        f(join_button);
      }
    </script>
  </body>
</html>
